<!doctype html>
<!-- CncAi โ Version 2.5.0 | Structured Build -->
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>CNC AI โ CNC Router & Laser Engraving & 3D Printing</title>

  <!-- ููุชุจุงุช ุฎุงุฑุฌูุฉ -->
  <script src="https://docs.opencv.org/4.8.0/opencv.js" async></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>

  <!-- ูููุงุช ุงููุดุฑูุน -->
  <link rel="stylesheet" href="style.css"/>
</head>

<body>
  <div class="app">
    <!-- ===== Header ===== -->
    <header>
      <h1>CNC AI โ CNC Router & Laser Engraving & 3D Printing</h1>
      <div id="cvState">
        <span class="loading"></span>
        <span class="version-string">CncAi โ ุงููุณุฎุฉ ุงููุณุชูุฑุฉ 2.5.0</span>
        ุฌุงุฑู ุชุญููู OpenCV...
      </div>
    </header>

    <!-- ===== Main Layout ===== -->
    <div class="grid">
      <!-- Left Panel: Tabs and Previews -->
      <div class="panel" id="leftPanel">

        <!-- ุงุฎุชูุงุฑ ุงูุตูุฑุฉ -->
        <div style="display:flex;gap:8px;align-items:center;">
          <input id="fileInput" type="file" accept="image/*"/>
          <label class="file-input-label" for="fileInput">๐ ุงุฎุชุฑ ุตูุฑุฉ</label>
          <div style="flex:1"></div>

          <label for="edgeMode" style="font-weight:normal;color:#9bb0c8">Edge Mode:</label>
          <select id="edgeMode" style="width:140px">
            <option value="auto">Canny (ุนุงุฏู)</option>
            <option value="sobel">Sobel (ุฏููู)</option>
            <option value="laplace">Laplacian (ูุงุนูู)</option>
          </select>
        </div>

        <!-- ุญุณุงุณูุฉ ุงูุญูุงู -->
        <div style="display:flex;align-items:center;gap:8px;margin-top:8px">
          <label style="margin:0;color:#9bb0c8">ุญุณุงุณูุฉ ุงูุญูุงู:</label>
          <input id="edgeSensitivity" type="range" min="0.1" max="1.0" step="0.05" value="0.33" style="flex:1">
          <div id="edgeValue" style="min-width:44px;text-align:center;color:#cfeaf2">0.33</div>
        </div>

        <!-- ุฃุฒุฑุงุฑ Colormap -->
        <div class="colormap-section">
          <div class="colormap-title">๐จ ุฎูุงุฑุงุช ุชุฏุฑุฌ ุงูุฃููุงู ๐จ</div>
          <div class="colormap-buttons" id="colormapButtons">
            <button data-map="jet" class="active">Jet</button>
            <button data-map="hot">Hot</button>
            <button data-map="cool">Cool</button>
            <button data-map="gray">Gray</button>
          </div>
          <div class="small-meta">ุชุทุจู ุนูู Heatmap ูTop View ูุงููุนุงููุงุช ุงูุฃุฎุฑู</div>
        </div>

        <!-- ุงูุชุจููุจุงุช -->
        <div class="tab-buttons">
          <button data-tab="original" class="active">๐ผ๏ธ ุงูุฃุตููุฉ</button>
          <button data-tab="heatmap">๐ฅ Heatmap</button>
          <button data-tab="contour">๐ Contours</button>
          <button data-tab="topview">๐ Top View</button>
          <button data-tab="threed">๐ง 3D Models</button>
          <button data-tab="simulation">๐ฌ ุงููุญุงูุงุฉ</button>
        </div>

        <!-- ูุญุชูู ุงูุชุจููุจุงุช -->
        <div id="original" class="tab-content active">
          <canvas id="canvasOriginal"></canvas>
        </div>
        <div id="heatmap" class="tab-content">
          <canvas id="canvasHeatmap"></canvas>
        </div>
        <div id="contour" class="tab-content">
          <canvas id="canvasContour"></canvas>
        </div>
        <div id="topview" class="tab-content">
          <canvas id="topView"></canvas>
          <div id="topLegend"></div>
        </div>
        <div id="threed" class="tab-content">
          <div id="threeDContainer"><canvas id="canvas3D"></canvas></div>
        </div>
        <div id="simulation" class="tab-content">
          <div id="threeContainer"></div>
        </div>
      </div>

      <!-- Right Panel: Machine Settings -->
      <div class="panel" id="rightPanel">
        <h3>โ๏ธ ุฅุนุฏุงุฏุงุช ุงููุงูููุฉ</h3>

        <label for="machineCategory">ููุน ุงููุงูููุฉ</label>
        <select id="machineCategory">
          <option value="router">CNC Router</option>
          <option value="laser">Laser Engraver</option>
          <option value="threed">3D Printer</option>
        </select>

        <!-- Router Settings -->
        <div id="routerSettings" class="machine-settings">
          <h4>๐ ุฅุนุฏุงุฏุงุช CNC Router</h4>
          <label for="feedRate">ุณุฑุนุฉ ุงูุชุบุฐูุฉ</label>
          <input id="feedRate" type="number" value="800"/>
          <label for="safeZ">ุงุฑุชูุงุน ุงูุฃูุงู</label>
          <input id="safeZ" type="number" value="5"/>
          <button id="btnGen" class="primary">โก ุชูููุฏ G-code</button>
        </div>

        <!-- Laser Settings -->
        <div id="laserSettings" class="machine-settings" style="display:none;">
          <h4>โก ุฅุนุฏุงุฏุงุช Laser Engraver</h4>
          <label for="laserPower">ููุฉ ุงูููุฒุฑ (%)</label>
          <input id="laserPower" type="range" min="0" max="100" value="80"/>
          <label for="laserSpeed">ุณุฑุนุฉ ุงูููุฒุฑ (ูู/ุฏูููุฉ)</label>
          <input id="laserSpeed" type="number" value="2000"/>
          <button id="btnLaserEngrave" class="primary">ุชูููุฏ ููุฏ ููุฒุฑ</button>
        </div>

        <!-- 3D Settings -->
        <div id="threedSettings" class="machine-settings" style="display:none;">
          <h4>๐ง ุฅุนุฏุงุฏุงุช ุงูุทุจุงุนุฉ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ</h4>
          <label for="threedFileInput">ุชุญููู ููู 3D</label>
          <input id="threedFileInput" type="file" accept=".stl,.obj"/>
          <button id="btnSliceModel" class="primary">โก ุชูููุฏ G-code (3D)</button>
        </div>

        <label for="gcodeOut">๐ ูุฎุฑุฌุงุช G-code</label>
        <textarea id="gcodeOut" readonly placeholder="ุณูุธูุฑ G-code ููุง ุจุนุฏ ุงูุชูููุฏ..."></textarea>
      </div>
    </div>
  </div>

  <!-- Progress & Debug Overlays -->
  <div class="progress-overlay" id="progressOverlay">
    <div class="progress-spinner"></div>
    <div class="progress-text" id="progressText">ุฌุงุฑู ุงููุนุงูุฌุฉ...</div>
  </div>
  <div id="toast"></div>
  <div id="debugOverlay"></div>

  <!-- ุณูุฑุจุช ุงููุดุฑูุน -->
  <script src="script.js"></script>
</body>
</html>
