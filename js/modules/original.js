import { toImageData } from '../utils.js'; import { Debug } from '../debug.js'; import { TaskManager } from '../taskmanager.js'; import { MemoryManager } from '../memorymanager.js'; let currentImage=null; export function getCurrentImage(){ return currentImage; } export function initOriginal(){ const input=document.getElementById('upload-image'); const startBtn=document.getElementById('start-analysis'); const canvas=document.getElementById('image-canvas'); const ctx=canvas.getContext('2d'); input.addEventListener('change',(e)=>{ const file=e.target.files[0]; if(!file) return; const img=new Image(); img.crossOrigin='anonymous'; img.onload=()=>{ const maxW=1024; const scale=Math.min(1, maxW/img.width); canvas.width=Math.round(img.width*scale); canvas.height=Math.round(img.height*scale); ctx.drawImage(img,0,0,canvas.width,canvas.height); currentImage=img; Debug.log('Loaded image: '+(file.name||'image')+' '+canvas.width+'x'+canvas.height); }; img.src=URL.createObjectURL(file); }); startBtn.addEventListener('click',()=>{ TaskManager.add(async ()=>{ Debug.log('Starting analysis task...'); await new Promise(r=>setTimeout(r,200)); Debug.log('Analysis completed'); },'analysis'); }); }